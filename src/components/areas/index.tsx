import React, {Component} from "react";
import {Maps} from "../map";
import "./areas.scss";
import {Form} from "./form";
import {Area, LatLng} from "../types";

const pointInsideItu = [-23.26663327505206, -47.307357789832174];

const allOrders = [[-23.6268238,-46.6405938],[-23.5582678,-46.6905979],[-23.6154711,-46.6749429],[-23.5307223,-46.7278676],[-23.5481768,-46.6430774],[-23.6079133,-46.6778401],[-23.5307223,-46.7278676],[-23.5993245,-46.665115],[-23.6190756,-46.6379402],[-23.6023762,-46.666507],[-23.5765899,-46.6411788],[-23.5525488,-46.6775233],[-23.5647716,-46.6921563],[-23.5968147,-46.6792943],[-23.5618857,-46.6887369],[-23.5619806,-46.66593],[-23.5584285,-46.6808616],[-23.5833263,-46.681372],[-23.5334648,-46.7063249],[-23.5602123,-46.6776855],[-23.5554447,-46.7051715],[-23.5897771,-46.676188],[-23.595069,-46.683486],[-23.5602123,-46.6776855],[-23.6270267,-46.6999268],[-23.5934626,-46.6794372],[-23.6046477,-46.6802873],[-23.559675,-46.688934],[-23.5437322,-46.6834393],[-23.6053513,-46.6576034],[-23.5894366,-46.674095],[-23.5503823,-46.6820338],[-23.6272492,-46.6752851],[-23.5933896,-46.6772355],[-23.5856803,-46.6786418],[-23.5855872,-46.6848162],[-23.5544257,-46.6876059],[-23.5549658,-46.6342797],[-23.6130297,-46.6726524],[-23.6253163,-46.629251],[-23.55898,-46.6922574],[-23.5993265,-46.6738339],[-23.6184603,-46.6550953],[-23.5646127,-46.6881863],[-23.5248076,-46.6540124],[-23.6149986,-46.6897953],[-23.6032799,-46.6601876],[-23.5554149,-46.6779878],[-23.6039905,-46.6428543],[-23.5644708,-46.686921],[-23.5251179,-46.7330986],[-23.6135916,-46.6791189],[-23.5610933,-46.6348397],[-23.558794,-46.6875539],[-23.5543876,-46.6762912],[-23.6187847,-46.6977706],[-23.6187865,-46.6512356],[-23.5578071,-46.634073],[-23.6189391,-46.680991],[-23.6160902,-46.6741659],[-23.6194211,-46.6380027],[-23.620233,-46.668794],[-23.5419578,-46.6861198],[-23.5470006,-46.6901302],[-23.5630646,-46.6865378],[-23.6135916,-46.6791189],[-23.559995,-46.6331825],[-23.6189391,-46.680991],[-23.6003317,-46.6690478],[-23.5993265,-46.6738339],[-23.5992123,-46.6635275],[-23.5184092,-46.6881064],[-23.6167487,-46.6862646],[-23.5499218,-46.6798837],[-23.5515356,-46.6799778],[-23.6085289,-46.6921898],[-23.6271808,-46.6366057],[-23.6271808,-46.6366057],[-23.5653539,-46.6924524],[-23.5557258,-46.6903674],[-23.6112496,-46.6837418],[-23.5488865,-46.6890555],[-23.5869355,-46.6792924],[-23.6382824,-46.6971129],[-23.5461784,-46.6911614],[-23.6105646,-46.6544568],[-23.560847,-46.6909106],[-23.5634772,-46.6640945],[-23.5651565,-46.679735],[-23.5634772,-46.6640945],[-23.6120542,-46.6844052],[-23.6194211,-46.6380027],[-23.5562097,-46.6793043],[-23.6187865,-46.6512356],[-23.5373135,-46.7074529],[-23.5557258,-46.6903674],[-23.6119843,-46.6944503],[-23.6329603,-46.6951242],[-23.5527985,-46.6897297],[-23.5425609,-46.6825114],[-23.5992123,-46.6635275],[-23.6164477,-46.6366672],[-23.6208856,-46.6935334],[-23.6218858,-46.6841651],[-23.6040413,-46.6625222],[-23.6219977,-46.6952372],[-23.5213003,-46.7309686],[-23.5379914,-46.706766],[-23.5359407,-46.7020178],[-23.5364882,-46.7193475],[-23.6077941,-46.6931],[-23.5243026,-46.6837136],[-23.6155161,-46.6553115],[-23.5509604,-46.6855459],[-23.5851911,-46.6392769],[-23.5996861,-46.6420012],[-23.5610325,-46.6873167],[-23.6336793,-46.7100814],[-23.6092246,-46.661421],[-23.5597476,-46.6768996],[-23.5803873,-46.6620953],[-23.6337883,-46.6651825],[-23.5703489,-46.654829],[-23.5960676,-46.6396858],[-23.5610705,-46.6852294],[-23.5838681,-46.6720256],[-23.5499254,-46.6425999],[-23.5613285,-46.6943239],[-23.5564928,-46.7034881],[-23.5977201,-46.6840342],[-23.5967944,-46.6881935],[-23.5224168,-46.6708748],[-23.5838681,-46.6720256],[-23.60868,-46.6690308],[-23.5949266,-46.6861548],[-23.5662317,-46.6643925],[-23.5589194,-46.698084],[-23.5926374,-46.6841301],[-23.5830742,-46.6783361],[-23.5830742,-46.6783361],[-23.6006751,-46.6827498],[-23.55898,-46.6922574],[-23.5604596,-46.6924849],[-23.5919393,-46.6791662],[-23.5992348,-46.6806238],[-23.5956595,-46.6881542],[-23.5573889,-46.6648942],[-23.5961691,-46.686766],[-23.5580184,-46.6823188],[-23.5615,-46.6930591],[-23.5859532,-46.6730152],[-23.5660654,-46.688517],[-23.5694081,-46.6897615],[-23.554121,-46.6758512],[-23.5417771,-46.6454941],[-23.5612082,-46.6793323],[-23.5850911,-46.6829888],[-23.6029628,-46.6798546],[-23.5830481,-46.6793569],[-23.5681889,-46.6927294],[-23.5843915,-46.6855185],[-23.5947604,-46.6898187],[-23.5829593,-46.6790524],[-23.5438572,-46.6445884],[-23.599193,-46.6782742],[-23.5555032,-46.6825316],[-23.5625365,-46.685561],[-23.5632558,-46.6931078],[-23.5947604,-46.6898187],[-23.5662741,-46.6583564],[-23.5639744,-46.6680108],[-23.5425234,-46.6430362],[-23.5871246,-46.6856099],[-23.5467941,-46.647965],[-23.5608786,-46.6570743],[-23.557432,-46.677054],[-23.5869355,-46.6792924],[-23.5872618,-46.6813833],[-23.5693914,-46.6897738],[-23.5603288,-46.6898334],[-23.5612082,-46.6793323],[-23.561053,-46.6936284],[-23.5661669,-46.6844257],[-23.5532869,-46.6824802],[-23.560847,-46.6909106],[-23.5604418,-46.6924943],[-23.5662693,-46.6910944],[-23.5897659,-46.6783996],[-23.6029628,-46.6798546],[-23.5611803,-46.6875766],[-23.5585341,-46.6804091],[-23.590471,-46.6737725],[-23.5585341,-46.6804091],[-23.5803985,-46.6792002],[-23.5517954,-46.6931258],[-23.5550357,-46.6773607],[-23.5949266,-46.6861548],[-23.5970488,-46.6794265],[-23.5888156,-46.6872347],[-23.5951564,-46.6889763],[-23.5952139,-46.6826703],[-23.5509604,-46.6855459],[-23.5919393,-46.6791662],[-23.5885642,-46.6817396],[-23.5850911,-46.6829888],[-23.5798351,-46.6707722],[-23.5940323,-46.6860512],[-23.5563339,-46.6873626],[-23.5467881,-46.6504031],[-23.5821202,-46.6838159],[-23.5961691,-46.686766],[-23.5608786,-46.6570743],[-23.5877892,-46.674622],[-23.6011294,-46.6740923],[-23.5527985,-46.6897297],[-23.5977201,-46.6840342],[-23.5784291,-46.6754228],[-23.5861551,-46.6806594],[-23.5897659,-46.6783996],[-23.5859532,-46.6730152],[-23.5954129,-46.6840379],[-23.5458711,-46.6466427],[-23.557432,-46.677054],[-23.5967944,-46.6881935],[-23.5926374,-46.6841301],[-23.5650927,-46.6920239], [-29.9212394,-51.1800968],[-26.7250024,-53.0441967],[-26.725002,-53.044197],[-24.01628,-46.286002],[-23.791946,-46.531742],[-23.762835,-46.687109],[-23.7385,-46.387029],[-23.72348,-46.690536],[-23.705894,-46.686476],[-23.703101,-46.774349],[-23.70286,-46.85917],[-23.685091,-46.706808],[-23.675241,-46.696761],[-23.671973,-46.699482],[-23.669311,-46.55027],[-23.657111,-46.699423],[-23.656379,-46.754368],[-23.655602,-46.788208],[-23.6518148,-46.8560157],[-23.645514,-46.985496],[-23.635703,-46.643638],[-23.631923,-46.586534],[-23.628926,-46.731862],[-23.627153,-46.608117],[-23.626951,-46.740091],[-23.626922,-46.738818],[-23.625296,-46.618008],[-23.621903,-46.670371],[-23.621015,-46.565726],[-23.620305,-46.735614],[-23.618572,-46.677957],[-23.61824,-46.618272],[-23.618231,-46.610695],[-23.616994,-46.67472],[-23.616425,-46.691181],[-23.616237,-46.710146],[-23.612867,-46.60911],[-23.612504,-46.682172],[-23.611629,-46.706457],[-23.611304,-46.622035],[-23.610792,-46.672676],[-23.6107919,-46.6726763],[-23.61072,-46.725829],[-23.610619,-46.684515],[-23.609808,-46.707383],[-23.609212,-46.691328],[-23.608808,-46.739626],[-23.60868,-46.669031],[-23.60868,-46.6690308],[-23.608176,-46.680877],[-23.60792,-46.664736],[-23.6068326,-46.672954],[-23.606245,-46.688305],[-23.604837,-46.670335],[-23.603596,-46.615417],[-23.603327,-46.683537],[-23.599715,-46.687781],[-23.5997145,-46.6877807],[-23.598472,-46.477912],[-23.596858,-46.73849],[-23.592766,-46.65101],[-23.590407,-46.842529],[-23.586017,-46.716336],[-23.585769,-46.635422],[-23.582474,-46.764748],[-23.581457,-46.740679],[-23.580946,-46.605917],[-23.579686,-46.625806],[-23.575464,-46.732258],[-23.575137,-46.75142],[-23.573069,-46.652512],[-23.573069,-46.6525119],[-23.558827,-46.640816],[-23.556322,-46.649872],[-23.551279,-46.562267],[-23.550651,-46.633382],[-23.549851,-46.590913],[-23.5465836,-46.5447228],[-23.546488,-46.747927],[-23.538722,-46.716832],[-23.538353,-46.329761],[-23.53629,-46.53459],[-23.528252,-46.310457],[-23.5251796,-46.8193572],[-23.524808,-46.654012],[-23.523415,-46.481697],[-23.52195,-46.664398],[-23.5152866,-46.607848],[-23.514807,-47.427071],[-23.510097,-46.662982],[-23.509564,-46.494931],[-23.505042,-46.534907],[-23.501031,-47.52465],[-23.500727,-47.476565],[-23.500472,-46.71935],[-23.499395,-47.507209],[-23.49737,-46.726648],[-23.495364,-46.677412],[-23.495338,-46.557584],[-23.486889,-46.591828],[-23.4866948,-47.4391609],[-23.483948,-46.733805],[-23.47569,-47.476538],[-23.473417,-46.559721],[-23.473401,-46.634283],[-23.461357,-47.504159],[-23.456253,-46.612626],[-23.455668,-46.078796],[-23.453063,-47.453354],[-23.434511,-46.574621],[-23.404237,-46.473501],[-23.172535,-45.892785],[-22.956797,-43.029327],[-22.956038,-43.181754],[-22.9299759,-47.1175209],[-22.913153,-43.181731],[-22.908036,-43.099486],[-22.7199793,-47.6452075],[-22.4385273,-43.1434071],[-21.2048,-41.88801],[-20.784709,-49.413095]];
const lstOrders: LatLng[] = [...allOrders, pointInsideItu].map(([lat, lng]) => ({lat, lng}));



const myAreas: Area[] = [
    {
        id: 1,
        name: 'Vila Mariana',
        shippingFee: 13,
        polygon: [
            {lat: -23.575735196340197, lng: -46.62225723965094},
            {lat: -23.58758709569398, lng: -46.62734985351563},
            {lat: -23.598284349761048, lng: -46.62117004394532},
            {lat: -23.62072477107451, lng: -46.591701514553286},
            {lat: -23.608036968133725, lng: -46.646232604980476},
            {lat: -23.633306504324473, lng: -46.69366837246344},
            {lat: -23.601115829818816, lng: -46.681938171386726},
            {lat: -23.56912703656044, lng: -46.683368689846255}
        ]
    },
    {
        id: 2,
        name: 'Sorocaba',
        shippingFee: 18,
        polygon: [
            {lng: -47.449951, lat: -23.537312},
            {lng: -47.452526, lat: -23.54219},
            {lng: -47.461109, lat: -23.543056},
            {lng: -47.467546, lat: -23.545495},
            {lng: -47.477589, lat: -23.548406},
            {lng: -47.483597, lat: -23.544708},
            {lng: -47.487717, lat: -23.541246},
            {lng: -47.490978, lat: -23.524248},
            {lng: -47.48909, lat: -23.510397},
            {lng: -47.480164, lat: -23.501186},
            {lng: -47.462654, lat: -23.494101},
            {lng: -47.451839, lat: -23.49741},
            {lng: -47.452183, lat: -23.506147},
            {lng: -47.453213, lat: -23.510397},
            {lng: -47.450809, lat: -23.514962},
            {lng: -47.453041, lat: -23.518976},
            {lng: -47.45141, lat: -23.525035},
            {lng: -47.449951, lat: -23.528262},
            {lng: -47.449951, lat: -23.537312},
            {lng: -47.449951, lat: -23.537312},
            {lng: -47.449951, lat: -23.537312}
        ]
    },
    {
        "id": 3,
        "name": 'itu',
        "shippingFee": 13.32,
        "polygon": [
            {
                "lat": -23.229410576300733,
                "lng": -47.36881256278139
            },
            {
                "lat": -23.227202123768013,
                "lng": -47.23011017020327
            },
            {
                "lat": -23.31046701707402,
                "lng": -47.23354339774233
            },
            {
                "lat": -23.30731399242153,
                "lng": -47.37705230887514
            }
        ]
    }
];

interface StateAreas {
    lstAreas: Area[];
    selectedArea: Area | undefined;
}

export class Areas extends Component<{}, StateAreas> {
    state = {
        lstAreas: [...myAreas],
        selectedArea: undefined
    };

    private addArea = (area: Area) => {
        const {lstAreas} = this.state;

        const newId = Math.max(...lstAreas.map(x => x.id as number)) + 1;
        area.id = newId;
        const newAreas = [...lstAreas, area];
        this.setState({selectedArea: area, lstAreas: newAreas});
    };

    public render = () => (
        <div className="area">
            <Maps areas={this.state.lstAreas} editingArea={this.state.selectedArea}
                  orders={lstOrders}
                  onChangeArea={this.handleChangeArea}/>
            {this.renderListAreas()}
        </div>
    );

    private handleChangeArea = (polygon: LatLng[]) => {
        const {selectedArea, lstAreas} = this.state;

        if (!selectedArea)
            return;

        const editedArea = selectedArea || {} as Area;
        editedArea.polygon = polygon;

        const newLstAreas = [...lstAreas.filter(x => editedArea?.id !== x.id), editedArea];

        this.setState({selectedArea: undefined, lstAreas: newLstAreas})
    };

    private renderListAreas = () => (
        <div className="areas">
            <h5>Registered Areas</h5>
            <Form onAdd={this.addArea}/>
            <div className="listAreas">
                {this.state.lstAreas.map(this.renderArea)}
            </div>
        </div>
    );

    private renderArea = (area: Area, index: number) => {
        const styleActive = this.state.selectedArea === area ? 'active' : '';
        return (
            <div className={`item ${styleActive}`} onClick={() => this.selectArea(area)} key={index}>
                <span>{area.name}</span>
                <span>{area.shippingFee}</span>
            </div>
        );
    };

    private selectArea = (area: Area) => {
        this.setState({selectedArea: area});
    }
}

